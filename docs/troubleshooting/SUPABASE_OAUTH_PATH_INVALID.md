# Fix: "requested path is invalid" OAuth Error

## Problem

You get the error `{"error":"requested path is invalid"}` when:
- Trying to access the OAuth URL directly in Safari
- Or during the OAuth flow in the app

## Understanding the Error

### ‚úÖ Normal Behavior in Safari

When you manually access the OAuth endpoint in Safari:
```
https://REDACTED_SUPABASE_URL/auth/v1/authorize?provider=google
```

You'll get `{"error":"requested path is invalid"}` because:
- The OAuth URL needs to be generated by Supabase with proper query parameters
- Accessing it directly without the right parameters is invalid
- **This is expected** - you can't test OAuth by accessing the URL directly

### ‚ùå Real Problem: OAuth Flow Error

If you get this error **during the OAuth flow in your app**, it means:
1. The redirect URL format in Supabase is incorrect
2. Or the OAuth provider (Google) isn't properly configured

## Solution: Fix Supabase Configuration

### Step 1: Verify Redirect URLs in Supabase

1. **Go to Supabase Dashboard**
   - [Supabase Dashboard](https://app.supabase.com)
   - Select your **NftGO** project

2. **Navigate to URL Configuration**
   - Go to **Authentication** ‚Üí **URL Configuration**

3. **Set Site URL**
   ```
   nftgo://
   ```

4. **Add Redirect URLs** (one per line):
   ```
   nftgo://
   nftgo://*
   ```

   **Important:** Use both formats:
   - `nftgo://` - exact match
   - `nftgo://*` - wildcard match (allows any path after `://`)

5. **Click SAVE**

### Step 2: Verify Google OAuth Provider

1. **Still in Supabase Dashboard**
   - Go to **Authentication** ‚Üí **Providers**
   - Click on **Google**

2. **Verify Settings:**
   - ‚úÖ **Enabled** toggle should be ON
   - **Client ID (for OAuth):** 
     ```
     823161628768-bhqc988srlk3khfom66i2v8727lf041l.apps.googleusercontent.com
     ```
   - **Client Secret (for OAuth):** 
     ```
     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
     ```

3. **Click SAVE**

### Step 3: Verify Google Cloud Console

1. **Go to Google Cloud Console**
   - [Google Cloud Console](https://console.cloud.google.com/)
   - Select project: **nftgo-479510**

2. **Check OAuth Client**
   - Go to **APIs & Services** ‚Üí **Credentials**
   - Click on your OAuth 2.0 Client ID

3. **Verify Authorized redirect URIs:**
   - Should include exactly:
     ```
     https://REDACTED_SUPABASE_URL/auth/v1/callback
     ```
   - **No trailing slash**
   - **Exact match** (case-sensitive)
   - **No extra spaces**

4. **Click SAVE** if you made changes

### Step 4: Wait and Test

1. **Wait 1-2 minutes** for changes to propagate
2. **Rebuild the app** in Xcode:
   ```bash
   npx expo prebuild --platform ios --clean
   ```
3. **Test Google Sign In** in the app (not in Safari directly!)

## Why This Happens

### OAuth Flow Explained

1. **App calls Supabase:**
   ```
   supabase.auth.signInWithOAuth({ provider: 'google' })
   ```

2. **Supabase generates OAuth URL:**
   ```
   https://REDACTED_SUPABASE_URL/auth/v1/authorize?
     provider=google&
     redirect_to=nftgo://&
     [other params]
   ```

3. **Browser opens URL** ‚Üí User signs in with Google

4. **Google redirects to Supabase:**
   ```
   https://REDACTED_SUPABASE_URL/auth/v1/callback?
     code=[auth_code]&
     [other params]
   ```

5. **Supabase validates and redirects to app:**
   ```
   nftgo://#access_token=[token]&refresh_token=[token]
   ```

6. **App receives deep link** ‚Üí User is signed in!

### Where It Fails

If Supabase gets an invalid `redirect_to` parameter, or the redirect URL isn't in the allowed list, it returns:
```json
{"error":"requested path is invalid"}
```

## Testing the OAuth Flow

**‚ùå DON'T test by:**
- Accessing OAuth URL directly in Safari
- Using curl/wget on the OAuth endpoint

**‚úÖ DO test by:**
- Running the app
- Clicking "Sign in with Google" button
- Completing the full OAuth flow

## Debugging

### Check Supabase Logs

1. Supabase Dashboard ‚Üí **Logs** ‚Üí **Auth Logs**
2. Look for OAuth attempts
3. Check what redirect URL is being used
4. Look for any error messages

### Check Xcode Console

When you click "Sign in with Google", look for:
```
üîê Google OAuth redirect URL: nftgo://
üîê Supabase Base URL: https://REDACTED_SUPABASE_URL
```

If you see errors, they'll show what's wrong.

### Test Redirect URL Format

Make sure in Supabase:
- **Site URL:** `nftgo://`
- **Redirect URLs:** 
  - `nftgo://`
  - `nftgo://*`

The wildcard (`*`) allows Supabase to redirect to any path after the scheme, which is needed for OAuth callbacks.

## Still Not Working?

1. **Double-check all URLs match exactly** (no typos, no extra spaces)
2. **Wait 2-3 minutes** after saving (propagation delay)
3. **Clear app data** and try again
4. **Check Supabase Auth Logs** for detailed error messages
5. **Verify Google Cloud Console** redirect URI is exactly:
   ```
   https://REDACTED_SUPABASE_URL/auth/v1/callback
   ```

---

**Note:** The "requested path is invalid" error when accessing the URL directly in Safari is **normal**. The OAuth URL must be generated by Supabase with proper parameters, not accessed directly.

